<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        body { background: #111b21; color: #e9edef; font-family: sans-serif; margin: 0; }
        .header { background: #202c33; padding: 15px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid #333; }
        .container { max-width: 600px; margin: 0 auto; padding: 10px; }
        .add-box { display: flex; gap: 10px; margin-bottom: 20px; }
        input { flex: 1; padding: 10px; border-radius: 5px; border: none; background: #2a3942; color: white; }
        button { padding: 10px 20px; background: #00a884; color: white; border: none; border-radius: 5px; cursor: pointer; }
        .contact { background: #202c33; padding: 15px; margin-bottom: 10px; border-radius: 8px; cursor: pointer; display: flex; align-items: center; }
        .contact:hover { background: #2a3942; }
        .avatar { width: 40px; height: 40px; background: #6a7f8a; border-radius: 50%; margin-right: 15px; display: flex; justify-content: center; align-items: center; font-weight: bold; }
    </style>
</head>
<body>
    <div class="header">
        <h3 id="welcome-msg" style="margin:0;">Dashboard</h3>
        <button onclick="logout()" style="background:#ef4444;">Logout</button>
    </div>

    <div class="container">
        <div class="add-box">
            <input type="text" id="friend-name" placeholder="Enter Friend's Username">
            <button onclick="addFriend()">Add</button>
        </div>
        <div id="list"></div>
    </div>

    <script>
        const user = localStorage.getItem('gc_session');
        if (!user) window.location.href = 'index.html'; // Security Check

        document.getElementById('welcome-msg').innerText = "Hi, " + user;

        function addFriend() {
            const f = document.getElementById('friend-name').value.trim();
            const allUsers = JSON.parse(localStorage.getItem('gc_users') || "{}");
            
            if (!allUsers[f]) return alert("User does not exist!");
            if (f === user) return alert("Can't add self");

            let contacts = JSON.parse(localStorage.getItem(`gc_contacts_${user}`) || "[]");
            if (!contacts.includes(f)) {
                contacts.push(f);
                localStorage.setItem(`gc_contacts_${user}`, JSON.stringify(contacts));
                loadContacts();
            }
        }

        function loadContacts() {
            const list = JSON.parse(localStorage.getItem(`gc_contacts_${user}`) || "[]");
            const el = document.getElementById('list');
            el.innerHTML = "";
            list.forEach(c => {
                // Yahan dekhein, hum chat.html par bhej rahe hain URL parameter ke sath
                el.innerHTML += `
                <div class="contact" onclick="window.location.href='chat.html?to=${c}'">
                    <div class="avatar">${c[0].toUpperCase()}</div>
                    <span>${c}</span>
                </div>`;
            });
        }

        function logout() {
            localStorage.removeItem('gc_session');
            window.location.href = 'index.html';
        }

        loadContacts();
    </script>
</body>
</html>
