<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>FaizanMsg Ultra - Firebase Edition</title>
    <meta name="theme-color" content="#0f172a">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;500;700;800&display=swap" rel="stylesheet">
    
    <!-- FIREBASE SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --primary: #6366f1;
            --accent: #ec4899;
            --bg-dark: #0f172a;
            --glass: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #ffffff;
            --text-sub: #94a3b8;
            --radius: 24px;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; user-select: none; }

        body {
            font-family: 'Plus Jakarta Sans', sans-serif;
            background: var(--bg-dark);
            color: var(--text-main);
            margin: 0;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }

        /* --- BACKGROUND --- */
        .ambient-light {
            position: fixed;
            top: 50%; left: 50%;
            width: 150vw; height: 150vw;
            background: radial-gradient(circle, rgba(99,102,241,0.2) 0%, rgba(236,72,153,0.15) 30%, rgba(15,23,42,0) 70%);
            transform: translate(-50%, -50%);
            z-index: -1;
            animation: pulse 10s infinite alternate;
            pointer-events: none;
        }
        @keyframes pulse { 0% { opacity: 0.5; transform: scale(0.9) translate(-50%, -50%); } 100% { opacity: 1; transform: scale(1.1) translate(-50%, -50%); } }

        /* --- APP SHELL --- */
        .app-shell {
            width: 100%; height: 100%; max-width: 480px;
            background: rgba(15, 23, 42, 0.6);
            backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px);
            display: flex; flex-direction: column; position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.5);
        }
        @media (min-width: 500px) { .app-shell { height: 90vh; border-radius: var(--radius); border: 1px solid var(--glass-border); } }

        /* --- HEADER --- */
        .header {
            padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--glass-border); background: rgba(15, 23, 42, 0.4); z-index: 50;
        }
        .logo { font-size: 22px; font-weight: 800; background: linear-gradient(to right, #fff, #94a3b8); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .user-chip { display: flex; align-items: center; gap: 8px; background: rgba(255,255,255,0.05); padding: 5px 10px; border-radius: 20px; font-size: 12px; border: 1px solid var(--glass-border); }
        .user-pic { width: 24px; height: 24px; border-radius: 50%; object-fit: cover; }

        /* --- VIEWS --- */
        .view { flex: 1; overflow-y: auto; padding: 20px; display: none; opacity: 0; transition: opacity 0.3s; }
        .view.active { display: block; opacity: 1; }

        /* --- LOGIN BUTTON --- */
        .btn-google {
            width: 100%; padding: 16px; border-radius: 16px; border: none;
            background: white; color: #1f2937; font-weight: 700; font-size: 16px;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 12px;
            transition: 0.2s; margin-top: 20px;
        }
        .btn-google:active { transform: scale(0.98); opacity: 0.9; }
        .btn-google img { width: 20px; height: 20px; }

        /* --- MAIL EFFECT MESSAGES --- */
        .msg-bubble {
            background: rgba(30, 41, 59, 0.6);
            border: 1px solid var(--glass-border);
            padding: 16px; border-radius: 18px; margin-bottom: 15px;
            position: relative; animation: slideIn 0.4s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }
        .msg-bubble.new { border-left: 3px solid var(--primary); background: rgba(99, 102, 241, 0.1); }
        @keyframes slideIn { from { opacity: 0; transform: translateY(20px) scale(0.95); } to { opacity: 1; transform: translateY(0) scale(1); } }
        
        .msg-header { display: flex; align-items: center; gap: 10px; margin-bottom: 8px; }
        .sender-pic { width: 28px; height: 28px; border-radius: 50%; background: var(--primary); display: flex; align-items: center; justify-content: center; font-size: 12px; font-weight: bold; color: white; }
        .sender-info { flex: 1; font-size: 13px; color: var(--text-sub); }
        .msg-time { font-size: 10px; opacity: 0.6; }

        /* --- INPUTS --- */
        .input-glass { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid var(--glass-border); padding: 15px; border-radius: 16px; color: white; margin-bottom: 15px; outline: none; font-family: inherit; }
        .btn-send { width: 100%; padding: 15px; background: linear-gradient(135deg, var(--primary), var(--accent)); border: none; border-radius: 16px; color: white; font-weight: bold; cursor: pointer; }

        /* --- UTILS --- */
        .hidden { display: none !important; }
        .toast { position: absolute; bottom: 30px; left: 50%; transform: translate(-50%, 20px); background: white; color: black; padding: 10px 20px; border-radius: 30px; font-weight: bold; opacity: 0; transition: 0.3s; pointer-events: none; box-shadow: 0 10px 30px rgba(0,0,0,0.3); font-size: 12px; z-index: 100; }
        .toast.show { opacity: 1; transform: translate(-50%, 0); }

        /* --- QR LINK --- */
        .link-box { background: rgba(0,0,0,0.3); padding: 15px; border-radius: 12px; font-family: monospace; font-size: 12px; word-break: break-all; margin-bottom: 10px; border: 1px solid var(--glass-border); color: var(--accent); }

    </style>
</head>
<body>

<div class="ambient-light"></div>

<div class="app-shell">
    
    <!-- TOP BAR -->
    <div class="header">
        <div class="logo">FaizanMsg<span style="color:var(--primary)">.Ultra</span></div>
        <div id="user-info" class="hidden">
            <div class="user-chip" onclick="logout()">
                <img id="my-pic" class="user-pic" src="">
                <span id="my-name">...</span>
                <span style="color:#ef4444; margin-left:5px;">âœ•</span>
            </div>
        </div>
    </div>

    <!-- VIEW: LOGIN (GOOGLE) -->
    <div id="view-auth" class="view active">
        <div style="height:100%; display:flex; flex-direction:column; justify-content:center; text-align:center;">
            <div style="font-size:40px; margin-bottom:20px;">ðŸ”’</div>
            <h1 style="font-size:28px; margin:0;">Secure Login</h1>
            <p style="color:var(--text-sub); margin-top:10px;">Connect your Google Account to access the encrypted vault.</p>
            
            <button class="btn-google" onclick="loginWithGoogle()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="G">
                Continue with Google
            </button>
        </div>
    </div>

    <!-- VIEW: INBOX (The Mail Effect) -->
    <div id="view-inbox" class="view">
        <h3 style="color:white; margin-top:0;">My Inbox ðŸ“¬</h3>
        
        <div style="margin-bottom:25px;">
            <p style="font-size:12px; color:var(--text-sub); margin-bottom:5px;">YOUR SECURE LINK:</p>
            <div id="share-link" class="link-box">Generating...</div>
            <button class="btn-send" style="padding:10px; font-size:12px;" onclick="copyLink()">Copy Link to Clipboard ðŸ“‹</button>
        </div>

        <div style="border-bottom:1px solid var(--glass-border); margin-bottom:15px; padding-bottom:5px; font-size:12px; color:var(--text-sub); text-transform:uppercase; letter-spacing:1px;">Recent Transmissions</div>
        <div id="msg-list" style="padding-bottom:50px;">
            <!-- Messages will load here with animation -->
            <div style="text-align:center; margin-top:50px; color:var(--text-sub); opacity:0.5;">Scanning Frequency...</div>
        </div>
    </div>

    <!-- VIEW: SEND MESSAGE -->
    <div id="view-send" class="view">
        <div style="text-align:center; margin-bottom:30px;">
            <div style="width:60px; height:60px; background:linear-gradient(135deg, var(--primary), var(--accent)); border-radius:50%; margin:0 auto 15px; display:flex; align-items:center; justify-content:center; font-size:24px;">ðŸš€</div>
            <h2>Send Message</h2>
            <p style="color:var(--text-sub); font-size:13px;">To: <span id="receiver-email" style="color:white; font-weight:bold;">...</span></p>
        </div>

        <textarea id="msg-input" class="input-glass" rows="4" placeholder="Type your secret message here..."></textarea>
        <button id="btn-send-action" class="btn-send" onclick="sendMessage()">Encrypt & Send âš¡</button>
        
        <div style="margin-top:20px; text-align:center;">
             <a href="javascript:void(0)" onclick="goHome()" style="color:var(--text-sub); font-size:13px; text-decoration:none;">Go back to my Inbox</a>
        </div>
    </div>

</div>

<div id="toast" class="toast">Notification</div>

<script>
    // ==========================================
    // 1. FIREBASE CONFIGURATION (PUT YOURS HERE)
    // ==========================================
    const firebaseConfig = {
        apiKey: "YOUR_API_KEY_HERE",
        authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
        projectId: "YOUR_PROJECT_ID",
        storageBucket: "YOUR_PROJECT_ID.appspot.com",
        messagingSenderId: "YOUR_SENDER_ID",
        appId: "YOUR_APP_ID"
    };

    // Initialize Firebase
    if (!firebase.apps.length) {
        firebase.initializeApp(firebaseConfig);
    }
    const auth = firebase.auth();
    const db = firebase.firestore();

    // ==========================================
    // 2. APP LOGIC
    // ==========================================
    
    let currentUser = null;
    let sendToEmail = null;

    // Check Routing on Load
    window.onload = () => {
        const params = new URLSearchParams(window.location.search);
        sendToEmail = params.get('to');

        // Auth State Listener
        auth.onAuthStateChanged(user => {
            if (user) {
                currentUser = user;
                updateUserInfo(user);
                
                if (sendToEmail && sendToEmail !== user.email) {
                    // Send Mode
                    showView('send');
                    document.getElementById('receiver-email').innerText = sendToEmail;
                } else {
                    // Inbox Mode
                    showView('inbox');
                    setupInboxListener(user.email);
                    const link = `${window.location.origin}${window.location.pathname}?to=${user.email}`;
                    document.getElementById('share-link').innerText = link;
                }
            } else {
                showView('auth');
            }
        });
    };

    // --- AUTHENTICATION ---
    function loginWithGoogle() {
        const provider = new firebase.auth.GoogleAuthProvider();
        auth.signInWithPopup(provider).catch(error => {
            toast("Login Failed: " + error.message);
        });
    }

    function logout() {
        auth.signOut().then(() => {
            window.location.href = window.location.pathname; // Reload to reset
        });
    }

    function updateUserInfo(user) {
        document.getElementById('user-info').classList.remove('hidden');
        document.getElementById('my-pic').src = user.photoURL;
        document.getElementById('my-name').innerText = user.displayName.split(' ')[0];
    }

    // --- MAIL EFFECT / INBOX ---
    function setupInboxListener(email) {
        const list = document.getElementById('msg-list');
        
        // Listen for messages where 'to' is my email
        db.collection("messages")
          .where("to", "==", email)
          .orderBy("timestamp", "desc")
          .limit(50)
          .onSnapshot((snapshot) => {
              if (snapshot.empty) {
                  list.innerHTML = "<div style='text-align:center; margin-top:30px; color:var(--text-sub);'>No signals intercepted yet.</div>";
                  return;
              }

              list.innerHTML = ""; // Clear current list to rebuild (simple approach)
              
              snapshot.forEach((doc) => {
                  const data = doc.data();
                  const isNew = (Date.now() - data.timestamp) < 60000; // Highlight if less than 1 min old
                  
                  const div = document.createElement('div');
                  div.className = `msg-bubble ${isNew ? 'new' : ''}`;
                  
                  // Generate Avatar Initials
                  const initial = data.fromName ? data.fromName[0] : '?';
                  
                  div.innerHTML = `
                      <div class="msg-header">
                          <div class="sender-pic">${initial}</div>
                          <div class="sender-info">
                              <div style="color:white; font-weight:700;">${data.fromName || 'Anonymous'}</div>
                              <div style="font-size:11px;">${data.fromEmail}</div>
                          </div>
                          <div class="msg-time">${new Date(data.timestamp).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</div>
                      </div>
                      <div style="color:white; font-size:15px; line-height:1.4;">
                          ${data.text}
                      </div>
                  `;
                  list.appendChild(div);
              });
          });
    }

    // --- SENDING ---
    function sendMessage() {
        const txt = document.getElementById('msg-input').value.trim();
        if(!txt) return toast("Message cannot be empty");

        const btn = document.getElementById('btn-send-action');
        btn.innerHTML = "Sending...";
        btn.disabled = true;

        db.collection("messages").add({
            to: sendToEmail,
            fromEmail: currentUser.email,
            fromName: currentUser.displayName,
            text: txt,
            timestamp: Date.now()
        }).then(() => {
            toast("Message Sent Successfully! ðŸš€");
            document.getElementById('msg-input').value = "";
            btn.innerHTML = "Encrypt & Send âš¡";
            btn.disabled = false;
        }).catch(err => {
            toast("Error: " + err.message);
            btn.innerHTML = "Retry";
            btn.disabled = false;
        });
    }

    // --- UTILITIES ---
    function showView(id) {
        document.querySelectorAll('.view').forEach(v => v.classList.remove('active'));
        document.getElementById('view-' + id).classList.add('active');
    }

    function copyLink() {
        const txt = document.getElementById('share-link').innerText;
        navigator.clipboard.writeText(txt);
        toast("Link Copied! Share it with friends.");
    }

    function toast(msg) {
        const t = document.getElementById('toast');
        t.innerText = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    function goHome() {
        window.location.href = window.location.pathname;
    }

</script>
</body>
</html>
