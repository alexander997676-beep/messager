<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>GhostMsg - By Faizan Ahmed</title>
    <!-- Icons -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;500;700&display=swap" rel="stylesheet">
    
    <style>
        /* --- ULTIMATE DARK THEME --- */
        :root {
            --bg-color: #0f172a;
            --card-bg: rgba(30, 41, 59, 0.75);
            --primary: #6366f1;
            --accent: #8b5cf6;
            --text-main: #f8fafc;
            --text-sec: #94a3b8;
            --danger: #ef4444;
        }

        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            background-image: radial-gradient(circle at 50% 0%, #1e293b 0%, #0f172a 70%);
            color: var(--text-main);
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 15px;
        }

        /* --- APP SHELL --- */
        .app-shell {
            width: 100%;
            max-width: 480px;
            background: var(--card-bg);
            backdrop-filter: blur(16px);
            -webkit-backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 24px;
            overflow: hidden;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            min-height: 85vh;
            display: flex;
            flex-direction: column;
            position: relative;
        }

        /* --- HEADER --- */
        .app-header {
            padding: 20px;
            text-align: center;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .logo-text {
            background: linear-gradient(to right, var(--primary), var(--accent));
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            font-weight: 800;
            font-size: 1.5rem;
            letter-spacing: 1px;
        }

        /* --- CONTENT AREA --- */
        .content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        /* --- FOOTER (MADE BY FAIZAN) --- */
        .app-footer {
            padding: 15px;
            text-align: center;
            border-top: 1px solid rgba(255,255,255,0.05);
            background: rgba(0,0,0,0.2);
            font-size: 0.85rem;
            color: var(--text-sec);
        }
        .app-footer b {
            color: var(--text-main);
            font-weight: 600;
        }
        .heart-beat {
            color: var(--danger);
            animation: beat 1.5s infinite;
            display: inline-block;
        }
        @keyframes beat { 0%, 100% { transform: scale(1); } 50% { transform: scale(1.2); } }

        /* --- FORMS --- */
        .input-group { margin-bottom: 15px; position: relative; }
        .input-field {
            width: 100%;
            background: rgba(15, 23, 42, 0.6);
            border: 1px solid rgba(255,255,255,0.1);
            padding: 16px;
            border-radius: 12px;
            color: white;
            font-size: 1rem;
            outline: none;
            transition: 0.3s;
        }
        .input-field:focus { border-color: var(--primary); }
        .toggle-password {
            position: absolute; right: 15px; top: 50%; transform: translateY(-50%);
            color: var(--text-sec); cursor: pointer;
        }

        /* --- BUTTONS --- */
        .btn {
            width: 100%; padding: 16px; border: none; border-radius: 12px;
            font-weight: 600; font-size: 1rem; cursor: pointer; margin-top: 10px;
            display: flex; justify-content: center; align-items: center; gap: 10px;
            transition: 0.2s;
        }
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--accent));
            color: white;
            box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3);
        }
        .btn-outline { background: transparent; border: 1px solid rgba(255,255,255,0.2); color: var(--text-sec); }
        .btn-danger { background: rgba(239, 68, 68, 0.1); color: var(--danger); }

        /* --- DASHBOARD --- */
        .profile-section { text-align: center; margin-bottom: 20px; }
        .avatar-circle {
            width: 80px; height: 80px; border-radius: 50%;
            border: 3px solid var(--primary); margin: 0 auto 10px;
            overflow: hidden; background: #333;
        }
        .avatar-circle img { width: 100%; height: 100%; object-fit: cover; }
        
        .link-card {
            background: rgba(99, 102, 241, 0.1); border: 1px dashed var(--primary);
            padding: 15px; border-radius: 12px; font-size: 0.85rem;
            word-break: break-all; margin-bottom: 10px; color: var(--text-sec);
        }

        /* --- MESSAGES --- */
        .msg-list { display: flex; flex-direction: column; gap: 15px; }
        .msg-item {
            background: rgba(255, 255, 255, 0.03); border-radius: 16px; padding: 16px;
            border-left: 4px solid var(--accent); position: relative;
        }
        .msg-header { display: flex; justify-content: space-between; font-size: 12px; color: var(--text-sec); margin-bottom: 8px; }
        .media-content { width: 100%; border-radius: 8px; margin-top: 10px; }

        /* --- MEDIA BAR --- */
        .media-bar { display: flex; gap: 15px; justify-content: center; margin: 20px 0; }
        .media-icon {
            width: 50px; height: 50px; border-radius: 50%; background: rgba(255,255,255,0.05);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.2rem; cursor: pointer; transition: 0.3s;
        }
        .media-icon:hover, .media-icon.active { background: var(--primary); color: white; }

        .hidden { display: none !important; }
        .loader-overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(15, 23, 42, 0.9); z-index: 100;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
        }
        .spinner {
            width: 40px; height: 40px; border: 4px solid rgba(255,255,255,0.1);
            border-top: 4px solid var(--primary); border-radius: 50%;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        
        .toast {
            position: fixed; bottom: 80px; left: 50%; transform: translateX(-50%) translateY(50px);
            background: var(--text-main); color: var(--bg-color);
            padding: 10px 20px; border-radius: 30px; font-weight: 600; opacity: 0;
            transition: 0.4s; z-index: 999; pointer-events: none;
        }
        .toast.show { transform: translateX(-50%) translateY(0); opacity: 1; }

    </style>
</head>
<body>

    <div class="app-shell">
        
        <!-- HEADER -->
        <div class="app-header">
            <div class="logo-text"><i class="fas fa-ghost"></i> GhostMsg</div>
        </div>

        <!-- CONTENT AREA (Scrollable) -->
        <div class="content">

            <!-- 1. LOGIN -->
            <div id="view-login">
                <h2 style="text-align:center; margin-bottom:5px;">Welcome Back</h2>
                <p style="text-align:center; color:var(--text-sec); margin-bottom:30px;">Login to view your secrets</p>

                <form onsubmit="app.login(event)">
                    <div class="input-group">
                        <input type="text" id="log-user" class="input-field" placeholder="Username" autocomplete="username" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="log-pass" class="input-field" placeholder="Password" autocomplete="current-password" required>
                        <i class="fas fa-eye toggle-password" onclick="app.togglePass('log-pass')"></i>
                    </div>
                    <button type="submit" class="btn btn-primary">Sign In <i class="fas fa-arrow-right"></i></button>
                </form>
                <button class="btn btn-outline" onclick="app.nav('signup')">Create Account</button>
            </div>

            <!-- 2. SIGNUP -->
            <div id="view-signup" class="hidden">
                <h2 style="text-align:center;">Join Anonymous</h2>
                <div class="profile-section" onclick="document.getElementById('reg-pic').click()" style="cursor:pointer">
                    <div class="avatar-circle">
                        <img id="avatar-preview" src="https://cdn-icons-png.flaticon.com/512/149/149071.png">
                    </div>
                    <span style="font-size:12px; color:var(--primary);">+ Upload Photo</span>
                </div>
                <input type="file" id="reg-pic" hidden accept="image/*" onchange="app.previewImage(this)">

                <form onsubmit="app.register(event)">
                    <div class="input-group">
                        <input type="text" id="reg-user" class="input-field" placeholder="Choose Username" autocomplete="username" required>
                    </div>
                    <div class="input-group">
                        <input type="password" id="reg-pass" class="input-field" placeholder="Create Password" autocomplete="new-password" required>
                    </div>
                    <button type="submit" class="btn btn-primary">Create Profile</button>
                </form>
                <button class="btn btn-outline" onclick="app.nav('login')">Back to Login</button>
            </div>

            <!-- 3. DASHBOARD -->
            <div id="view-dashboard" class="hidden">
                <div class="profile-section">
                    <div class="avatar-circle"><img id="dash-avatar" src=""></div>
                    <h3 id="dash-user" style="margin:5px 0;">User</h3>
                </div>

                <div class="link-card" id="share-link">Generating...</div>
                <div style="display:flex; gap:10px;">
                    <button class="btn btn-primary" onclick="app.copyLink()"><i class="fas fa-copy"></i> Copy</button>
                    <button class="btn btn-primary" style="background:#25D366;" onclick="app.shareWhatsapp()"><i class="fab fa-whatsapp"></i> WhatsApp</button>
                </div>

                <div style="margin-top:25px; display:flex; justify-content:space-between; align-items:center;">
                    <h4 style="margin:0;">Inbox</h4>
                    <span style="font-size:12px; color:var(--danger); cursor:pointer;" onclick="app.clearAllMessages()">Clear All</span>
                </div>
                <div id="msg-container" class="msg-list" style="margin-top:15px;"></div>
                <button class="btn btn-danger" onclick="app.logout()" style="margin-top:30px;">Logout</button>
            </div>

            <!-- 4. PUBLIC SENDER -->
            <div id="view-public" class="hidden">
                <div class="profile-section">
                    <div class="avatar-circle"><img id="pub-avatar" src=""></div>
                    <p style="color:var(--text-sec); font-size:12px;">Send secret message to</p>
                    <h3 id="pub-user" style="margin:0;">...</h3>
                </div>

                <textarea id="msg-text" class="input-field" rows="3" placeholder="Type secret message..."></textarea>

                <div class="media-bar">
                    <div class="media-icon" onclick="app.triggerFile('image')"><i class="fas fa-camera"></i></div>
                    <div class="media-icon" onclick="app.triggerFile('video')"><i class="fas fa-video"></i></div>
                    <div class="media-icon" id="btn-mic" onclick="app.toggleRec()"><i class="fas fa-microphone"></i></div>
                </div>

                <input type="file" id="file-image" hidden accept="image/*" onchange="app.handleFile('image')">
                <input type="file" id="file-video" hidden accept="video/*" onchange="app.handleFile('video')">
                
                <div id="preview-box" class="hidden" style="text-align:center; margin-bottom:15px; position:relative;">
                    <span onclick="app.resetMedia()" style="position:absolute; right:0; top:-10px; color:var(--danger); cursor:pointer;">&times; Remove</span>
                    <img id="prev-img" class="media-content hidden">
                    <video id="prev-vid" class="media-content hidden" controls></video>
                    <audio id="prev-aud" class="media-content hidden" controls></audio>
                </div>

                <button class="btn btn-primary" onclick="app.send()">Send Secretly <i class="fas fa-paper-plane"></i></button>
                <button class="btn btn-outline" onclick="location.href=location.pathname">Get your own link</button>
            </div>

        </div>

        <!-- FOOTER (BY FAIZAN) -->
        <div class="app-footer">
            Made by <b>Faizan Ahmed</b> <i class="fas fa-heart heart-beat"></i>
        </div>

        <!-- LOADER -->
        <div id="loader" class="loader-overlay hidden">
            <div class="spinner"></div>
            <p style="margin-top:15px; font-weight:bold;">Processing...</p>
        </div>

    </div>

    <!-- TOAST -->
    <div id="toast" class="toast">Message</div>

    <script>
        const app = {
            dbUsers: 'ghost_users_v5',
            dbMsgs: 'ghost_msgs_v5',
            state: { mediaRecorder: null, chunks: [], tempMedia: null },

            init: () => {
                const params = new URLSearchParams(window.location.search);
                const toUser = params.get('to');
                if (toUser) app.loadPublic(toUser);
                else {
                    const session = localStorage.getItem('ghost_session');
                    if (session) app.loadDashboard(session);
                    else app.nav('login');
                }
            },

            nav: (view) => {
                document.querySelectorAll('[id^="view-"]').forEach(el => el.classList.add('hidden'));
                document.getElementById(`view-${view}`).classList.remove('hidden');
            },

            togglePass: (id) => {
                const input = document.getElementById(id);
                input.type = input.type === 'password' ? 'text' : 'password';
            },

            loading: (show) => document.getElementById('loader').classList.toggle('hidden', !show),

            toast: (msg) => {
                const el = document.getElementById('toast');
                el.innerText = msg;
                el.classList.add('show');
                setTimeout(() => el.classList.remove('show'), 3000);
            },

            register: (e) => {
                e.preventDefault();
                const user = document.getElementById('reg-user').value.trim();
                const pass = document.getElementById('reg-pass').value.trim();
                const avatar = document.getElementById('avatar-preview').src;
                let db = JSON.parse(localStorage.getItem(app.dbUsers) || "{}");

                if (db[user]) return app.toast('Username Taken!');
                db[user] = { pass, avatar };
                localStorage.setItem(app.dbUsers, JSON.stringify(db));
                app.toast('Account Created!');
                app.nav('login');
                document.getElementById('log-user').value = user;
                document.getElementById('log-pass').value = pass;
            },

            login: (e) => {
                e.preventDefault();
                const user = document.getElementById('log-user').value.trim();
                const pass = document.getElementById('log-pass').value.trim();
                let db = JSON.parse(localStorage.getItem(app.dbUsers) || "{}");

                if (db[user] && db[user].pass === pass) {
                    localStorage.setItem('ghost_session', user);
                    app.loadDashboard(user);
                } else {
                    app.toast('Invalid Credentials');
                }
            },

            logout: () => {
                localStorage.removeItem('ghost_session');
                location.reload();
            },

            loadDashboard: (user) => {
                app.nav('dashboard');
                let db = JSON.parse(localStorage.getItem(app.dbUsers) || "{}");
                document.getElementById('dash-user').innerText = user;
                document.getElementById('dash-avatar').src = db[user].avatar;
                const link = window.location.href.split('?')[0] + "?to=" + user;
                document.getElementById('share-link').innerText = link;
                app.renderMessages(user);
            },

            copyLink: () => {
                navigator.clipboard.writeText(document.getElementById('share-link').innerText);
                app.toast('Link Copied!');
            },
            
            shareWhatsapp: () => {
                const link = document.getElementById('share-link').innerText;
                window.open(`https://wa.me/?text=Send%20me%20a%20secret%20message!%20${encodeURIComponent(link)}`, '_blank');
            },

            timeAgo: (date) => {
                const seconds = Math.floor((new Date() - new Date(date)) / 1000);
                if (seconds < 60) return "Just now";
                const mins = Math.floor(seconds / 60);
                if (mins < 60) return mins + "m ago";
                const hours = Math.floor(mins / 60);
                if (hours < 24) return hours + "h ago";
                return Math.floor(hours / 24) + "d ago";
            },

            renderMessages: (user) => {
                let msgs = JSON.parse(localStorage.getItem(app.dbMsgs) || "{}");
                let userMsgs = msgs[user] || [];
                const container = document.getElementById('msg-container');
                container.innerHTML = "";

                if(userMsgs.length === 0) {
                    container.innerHTML = "<p style='text-align:center; color:var(--text-sec)'>No secrets yet ðŸ‘»</p>";
                    return;
                }

                userMsgs.reverse().forEach((msg, index) => {
                    const originalIndex = userMsgs.length - 1 - index;
                    let mediaHtml = '';
                    if(msg.type === 'image') mediaHtml = `<img src="${msg.data}" class="media-content" onclick="app.viewFull(this.src)">`;
                    if(msg.type === 'video') mediaHtml = `<video src="${msg.data}" controls class="media-content"></video>`;
                    if(msg.type === 'audio') mediaHtml = `<audio src="${msg.data}" controls class="media-content"></audio>`;

                    const div = document.createElement('div');
                    div.className = 'msg-item';
                    div.innerHTML = `
                        <div class="msg-header">
                            <span>${app.timeAgo(msg.date)}</span>
                            <span style="color:var(--danger); cursor:pointer;" onclick="app.deleteMsg('${user}', ${originalIndex})"><i class="fas fa-trash"></i></span>
                        </div>
                        <div style="font-size:14px;">${msg.text || '<i>Media Only</i>'}</div>
                        ${mediaHtml}
                    `;
                    container.appendChild(div);
                });
            },

            deleteMsg: (user, index) => {
                if(!confirm("Delete this?")) return;
                let msgs = JSON.parse(localStorage.getItem(app.dbMsgs) || "{}");
                msgs[user].splice(index, 1);
                localStorage.setItem(app.dbMsgs, JSON.stringify(msgs));
                app.renderMessages(user);
                app.toast("Deleted");
            },

            clearAllMessages: () => {
                const user = localStorage.getItem('ghost_session');
                if(!confirm("Delete ALL?")) return;
                let msgs = JSON.parse(localStorage.getItem(app.dbMsgs) || "{}");
                msgs[user] = [];
                localStorage.setItem(app.dbMsgs, JSON.stringify(msgs));
                app.renderMessages(user);
                app.toast("Inbox Cleared");
            },

            loadPublic: (user) => {
                let db = JSON.parse(localStorage.getItem(app.dbUsers) || "{}");
                if (!db[user]) return document.body.innerHTML = "<h1 style='color:white;text-align:center'>User Not Found</h1>";
                app.nav('public');
                document.getElementById('pub-user').innerText = user;
                document.getElementById('pub-avatar').src = db[user].avatar;
            },

            previewImage: (input) => {
                if (input.files && input.files[0]) {
                    const reader = new FileReader();
                    reader.onload = (e) => document.getElementById('avatar-preview').src = e.target.result;
                    reader.readAsDataURL(input.files[0]);
                }
            },
            
            triggerFile: (type) => document.getElementById(`file-${type}`).click(),

            handleFile: (type) => {
                const file = document.getElementById(`file-${type}`).files[0];
                if (!file) return;
                if (file.size > 3 * 1024 * 1024) return app.toast('File too big (>3MB)');
                app.loading(true);
                const reader = new FileReader();
                reader.onload = (e) => {
                    app.state.tempMedia = { type, data: e.target.result };
                    document.getElementById('preview-box').classList.remove('hidden');
                    document.getElementById(type === 'image' ? 'prev-img' : 'prev-vid').src = e.target.result;
                    document.getElementById(type === 'image' ? 'prev-img' : 'prev-vid').classList.remove('hidden');
                    app.loading(false);
                };
                reader.readAsDataURL(file);
            },

            toggleRec: async () => {
                const btn = document.getElementById('btn-mic');
                if (app.state.mediaRecorder && app.state.mediaRecorder.state === 'recording') {
                    app.state.mediaRecorder.stop();
                    btn.classList.remove('active');
                } else {
                    try {
                        const stream = await navigator.mediaDevices.getUserMedia({ audio: true });
                        app.state.mediaRecorder = new MediaRecorder(stream);
                        app.state.chunks = [];
                        app.state.mediaRecorder.start();
                        btn.classList.add('active');
                        app.toast('Recording...');
                        app.state.mediaRecorder.ondataavailable = e => app.state.chunks.push(e.data);
                        app.state.mediaRecorder.onstop = () => {
                            const blob = new Blob(app.state.chunks, { type: 'audio/webm' });
                            const reader = new FileReader();
                            reader.readAsDataURL(blob);
                            reader.onload = (e) => {
                                app.state.tempMedia = { type: 'audio', data: e.target.result };
                                document.getElementById('preview-box').classList.remove('hidden');
                                const aud = document.getElementById('prev-aud');
                                aud.src = e.target.result;
                                aud.classList.remove('hidden');
                            };
                        };
                    } catch (e) { app.toast('Mic Denied'); }
                }
            },

            resetMedia: () => {
                app.state.tempMedia = null;
                document.getElementById('preview-box').classList.add('hidden');
                document.querySelectorAll('.media-content').forEach(el => el.classList.add('hidden'));
                document.getElementById('file-image').value = "";
                document.getElementById('file-video').value = "";
            },

            send: () => {
                const text = document.getElementById('msg-text').value.trim();
                const media = app.state.tempMedia;
                const user = document.getElementById('pub-user').innerText;
                if (!text && !media) return app.toast('Empty Message!');
                app.loading(true);
                setTimeout(() => {
                    try {
                        let msgs = JSON.parse(localStorage.getItem(app.dbMsgs) || "{}");
                        if (!msgs[user]) msgs[user] = [];
                        msgs[user].push({
                            text, type: media ? media.type : null, data: media ? media.data : null,
                            date: new Date().toISOString()
                        });
                        localStorage.setItem(app.dbMsgs, JSON.stringify(msgs));
                        app.toast('Secret Sent! ðŸš€');
                        document.getElementById('msg-text').value = "";
                        app.resetMedia();
                    } catch (e) { app.toast('Storage Full!'); }
                    app.loading(false);
                }, 1000);
            },
            
            viewFull: (src) => {
                const win = window.open("", "_blank");
                win.document.write(`<img src="${src}" style="width:100%">`);
            }
        };

        window.onload = app.init;
    </script>
</body>
</html>
